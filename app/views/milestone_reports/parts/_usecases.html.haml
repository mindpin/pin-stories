- usecases.each do |usecase|
  - milestone = usecase.milestone
  .usecase{:data=>{:id=>usecase.id}}
    .meta
      .id= usecase.id
      .name= usecase.content
      %a.new-issue{:href=>'javascript:;'} 添加问题
      .new-issue-form{:style=>'display:none;'}
        = render 'milestone_issues/parts/new_issue', :usecase=>usecase

    .issues
      :ruby
        state = params[:state] || 'OPEN'
        issues = usecase.issues.with_state(state)

      - issues.each do |issue|
        :ruby
          creator = issue.creator
          can_edit = admin_logged_in? || creator == current_user

          data = {:id => issue.id}

        .issue{:data=>data}
          .creator-avatar= avatar_link creator, :mini
          .content= issue.content
          .ops
            = link_to '编辑', 'javascript:;', :class=>'edit-issue'
            = link_to '删除', issue, :class=>'delete-issue', :confirm=>'确定要删除这个问题吗?', :method=>:delete
          .edit-issue-form{:style=>'display:none;'}
            = render 'milestone_issues/parts/edit_issue', :issue=>issue

    .children
      = render 'milestone_reports/parts/usecases', :usecases=>usecase.sub_usecases